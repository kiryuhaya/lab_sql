# lab_sql
Лабораторная работа по УД 3 



ВАРИАНТ 8
Уровень 1


1) Дана схема базы данных в виде следующих отношений.  С помощью операторов SQL создать логическую структуру соответствующих таблиц для хранения в СУБД, используя известные средства поддержания целостности (NOT NULL, UNIQUE, и т.д.). Обосновать выбор типов данных и используемые средства поддержания целостности. При выборе подходящих типов данных использовать информацию о конкретных значениях полей БД (см. прил.1);
МЕСТО РАБОТЫ (ИДЕНТИФИКАТОР, НАЗВАНИЕ ОРГ., АДРЕС РАБОТЫ, ЛЬГОТА %);
АВТОПРЕДПРИЯТИЕ (ИДЕНТИФИКАТОР, НАЗВАНИЕ, РАСПОЛОЖЕНИЕ, КОМИCСИOННЫЕ %); 
ТЕХНИКА (ИДЕНТИФИКАТОР, ТИП, АДРЕС ГАРАЖА, МАКС. КОЛ-ВО, СТОИМОСТЬ ЗАКАЗА РУБ); 
ЗАКАЗ (НОМЕР, ДАТА, МЕСТО РАБОТЫ, АВТО, ПРЕДПРИЯТИЕ, ТЕХНИКА, КОЛ-ВО, ОПЛАТА РУБ);

   код:
```   
CREATE TABLE Место_работы (
    ИДЕНТИФИКАТОР INT PRIMARY KEY, 
    НАЗВАНИЕ_ОРГ VARCHAR(255) NOT NULL,
    АДРЕС_РАБОТЫ VARCHAR(255) NOT NULL,
    ЛЬГОТА INT CHECK (ЛЬГОТА >= 0 AND ЛЬГОТА <= 100)
);
```
```
CREATE TABLE Автопредприятие (
    ИДЕНТИФИКАТОР INT PRIMARY KEY,
    НАЗВАНИЕ VARCHAR(255) NOT NULL,
    РАСПОЛОЖЕНИЕ VARCHAR(255) NOT NULL,
    КОМИССИОННЫЕ INT CHECK (КОМИССИОННЫЕ >= 0 AND КОМИССИОННЫЕ <= 100)
);
```
```
CREATE TABLE Техника (
    ИДЕНТИФИКАТОР INT PRIMARY KEY,
    ТИП VARCHAR(255) NOT NULL,
    АДРЕС_ГАРАЖА VARCHAR(255) NOT NULL,
    МАКС_КОЛ_ВО INT CHECK (МАКС_КОЛ_ВО >= 0),
    СТОИМОСТЬ_ЗАКАЗА_РУБ INT NOT NULL
);
```
```
CREATE TABLE Заказ (
    НОМЕР INT PRIMARY KEY,
    ДАТА VARCHAR(255) NOT NULL,
    МЕСТО_РАБОТЫ INT NOT NULL,
    АВТОПРЕДПРИЯТИЕ INT NOT NULL,
    ТЕХНИКА INT NOT NULL,
    КОЛ_ВО INT CHECK (КОЛ_ВО >= 0),
    ОПЛАТА_РУБ INT NOT NULL,
    FOREIGN KEY (МЕСТО_РАБОТЫ) REFERENCES Место_работы(ИДЕНТИФИКАТОР),
    FOREIGN KEY (АВТОПРЕДПРИЯТИЕ) REFERENCES Автопредприятие(ИДЕНТИФИКАТОР),
    FOREIGN KEY (ТЕХНИКА) REFERENCES Техника(ИДЕНТИФИКАТОР)
);
```

![image](https://github.com/user-attachments/assets/d787568d-5740-40f7-964d-f1b4b8ef2bff)




2) Ввести в ранее созданные таблицы конкретные данные (см. прил. 1). Использовать скрипт-файл из операторов INSERT или вспомогательную утилиту .

   код:
```
INSERT INTO Место_работы (ИДЕНТИФИКАТОР, НАЗВАНИЕ_ОРГ, АДРЕС_РАБОТЫ, ЛЬГОТА)
VALUES
(001, 'Песочный карьер 8', 'Бор', 0),
(002, 'Овощная база', 'Ильино', 5),
(003, 'ТЭЦ', 'Дзержинск', 5),
(004, 'Детский сад 1', 'Н.Новгород', 10),
(005, 'Стройплощадка 15', 'Н.Новгород', 0);
```
```
INSERT INTO Автопредприятие (ИДЕНТИФИКАТОР, НАЗВАНИЕ, РАСПОЛОЖЕНИЕ, КОМИССИОННЫЕ)
VALUES
(001, 'АТП 12', 'Н.Новгород', 7),
(002, 'МП Авто', 'Дзержинск', 6),
(003, 'АТП 9', 'Ильино', 6),
(004, 'АТП 7', 'Кстово', 4),
(005, 'АТП 3', 'Н.Новгород', 7),
(006, 'Борский автоотряд', 'Бор', 4);
```
```
INSERT INTO Техника (ИДЕНТИФИКАТОР, ТИП, АДРЕС_ГАРАЖА, МАКС_КОЛ_ВО, СТОИМОСТЬ_ЗАКАЗА_РУБ)
VALUES
(001, 'Грузовая машина', 'Н.Новгород', 10, 100000),
(002, 'Автобус', 'Н.Новгород', 5, 200000),
(003, 'Цистерна', 'Ильино', 4, 110000),
(004, 'Автокран', 'Бор', 3, 160000),
(005, 'Бетономешалка', 'Бор', 3, 130000),
(006, 'Самосвал', 'Кстово', 5, 100000),
(007, 'Автофургон', 'Дзержинск', 15, 100000);
```
```
INSERT INTO Заказ (НОМЕР, ДАТА, МЕСТО_РАБОТЫ, АВТОПРЕДПРИЯТИЕ, ТЕХНИКА, КОЛ_ВО, ОПЛАТА_РУБ)
VALUES
(00000, 'Понедельник', 001, 003, 007, 1, 100000),
(00001, 'Понедельник', 001, 005, 007, 2, 200000),
(00002, 'Понедельник', 003, 002, 007, 1, 100000),
(00003, 'Понедельник', 004, 003, 007, 1, 100000),
(00004, 'Вторник', 005, 004, 002, 2, 400000),
(00005, 'Среда', 001, 006, 004, 1, 160000),
(00006, 'Среда', 001, 004, 004, 1, 160000),
(00007, 'Среда', 004, 001, 004, 1, 160000),
(00008, 'Четверг', 002, 004, 003, 1, 110000),
(00009, 'Четверг', 002, 005, 002, 1, 200000),
(00010, 'Четверг', 004, 001, 006, 2, 200000),
(00011, 'Четверг', 005, 003, 005, 1, 200000),
(00012, 'Пятница', 004, 002, 001, 4, 400000),
(00013, 'Пятница', 004, 005, 001, 1, 100000),
(00014, 'Пятница', 004, 004, 001, 3, 300000),
(00015, 'Пятница', 005, 006, 006, 2, 200000),
(00016, 'Суббота', 002, 001, 001, 4, 400000);
```

![image](https://github.com/user-attachments/assets/1456a945-351c-42b0-bbc3-d36872a68a85)


3) Используя оператор SELECT создать запрос для вывода всех строк каждой таблицы. Проверить правильность ввода. При необходимости произвести коррекцию значений операторами INSERT, UPDATE, DELETE. 

   код:
```
SELECT * FROM Место_работы;
```

![image](https://github.com/user-attachments/assets/f2071a2d-88aa-46c7-afe4-b602f5fa56bd)

```
SELECT * FROM Автопредприятие;
```

![image](https://github.com/user-attachments/assets/28ce563d-7709-4617-9568-704478bf742f)

```
SELECT * FROM Техника;
```

![image](https://github.com/user-attachments/assets/491b28aa-5d7e-4983-832e-384a456f9f21)

```
SELECT * FROM Заказ;
```

![image](https://github.com/user-attachments/assets/3ef2b320-fe4b-4eb1-a3cf-406c82c93f11)


4) Создать запросы для вывода:
   
  a)названий всех различных мест работы, вместе с размером льгот;
   
  b) всех различных адресов, где расположены автопредприятия;
  
  c) всех различных мест расположения техники.

       код:
```
SELECT DISTINCT НАЗВАНИЕ_ОРГ, ЛЬГОТА
FROM Место_работы;
```

![image](https://github.com/user-attachments/assets/6b0382cf-9e9e-4cd0-9351-3e246d14a273)

```
SELECT DISTINCT РАСПОЛОЖЕНИЕ
FROM Автопредприятие;
```

![image](https://github.com/user-attachments/assets/2a7ba1f5-976e-4019-b713-06166fb57ddb)

```
SELECT DISTINCT АДРЕС_ГАРАЖА
FROM Техника;
```

![image](https://github.com/user-attachments/assets/ea4d140b-dfab-46dd-a24b-ffc31e42c84f)
  

5) Создать запросы для получения инорфмации о:
   
  a) типе и месте расположения техники, с максимальным количеством более 3;

  b) автопредприятиях с размером комиссионных более 5% и расположенных не в Н.Новгроде. Вывести также и размер комиссионных. Отсортировать по нему полученные результаты;
  
  c) местах работы, расположенных в Ильино.

     код:
```
SELECT ТИП, АДРЕС_ГАРАЖА
FROM Техника
WHERE МАКС_КОЛ_ВО > 3;
```

![image](https://github.com/user-attachments/assets/6ea2596a-ec30-460d-a995-55e08e304bc6)

```
SELECT НАЗВАНИЕ, РАСПОЛОЖЕНИЕ, КОМИССИОННЫЕ
FROM Автопредприятие
WHERE КОМИССИОННЫЕ > 5 AND РАСПОЛОЖЕНИЕ != 'Н.Новгород'
ORDER BY КОМИССИОННЫЕ;
```

![image](https://github.com/user-attachments/assets/2f9f0792-2b27-4f21-9b21-41e73de8a8ee)

```
SELECT НАЗВАНИЕ_ОРГ
FROM Место_работы
WHERE АДРЕС_РАБОТЫ = 'Ильино';
```

![image](https://github.com/user-attachments/assets/f1c7810d-a02d-43c0-933d-cc3de8635da3)

  
6) Для каждого заказа вывести следующие данные:
    
  a) название места работы,  техника, количество, оплата. Отсортировать по сумме оплаты и месту работы;
  
  b) номер, дату, название автопредприятия.

     код:
```
SELECT Место_работы.НАЗВАНИЕ_ОРГ, Техника.ТИП, Заказ.КОЛ_ВО, Заказ.ОПЛАТА_РУБ
FROM Заказ
JOIN Место_работы ON Заказ.МЕСТО_РАБОТЫ = Место_работы.ИДЕНТИФИКАТОР
JOIN Техника ON Заказ.ТЕХНИКА = Техника.ИДЕНТИФИКАТОР
ORDER BY Заказ.ОПЛАТА_РУБ DESC, Место_работы.НАЗВАНИЕ_ОРГ;
```

![image](https://github.com/user-attachments/assets/1ead972f-7132-4864-a524-67379bee96a0)

```
SELECT Заказ.НОМЕР, Заказ.ДАТА, Автопредприятие.НАЗВАНИЕ
FROM Заказ
JOIN Автопредприятие ON Заказ.АВТОПРЕДПРИЯТИЕ = Автопредприятие.ИДЕНТИФИКАТОР;
```

![image](https://github.com/user-attachments/assets/e05aa991-941d-432f-a55b-a1166f6d098d)


7) Вывести:
    
  a) названия автопредприятий, которые предоставляли технику на работу в другие населенные пункты для организаций с размером льгот от 3% и выше. Также включить в отчет названия этих организаций и место их расположения;

  b) идентификатор и тип машин, расположенных в том же месте, что и автопредприятие, направившее их на работу;
  
  c) тип машин, имеющих общих владельцев ( т.е. направленных на работу разными автопредприятиями) и имеющих стоимость заказа более 115000руб.
  
  d) название мест работы, для которых производился заказ техники на общую сумму более 100000руб.

     код:
```
SELECT Автопредприятие.НАЗВАНИЕ AS Автопредприятие, Место_работы.НАЗВАНИЕ_ОРГ AS Организация, Место_работы.АДРЕС_РАБОТЫ AS Местоположение
FROM Заказ
JOIN Автопредприятие ON Заказ.АВТОПРЕДПРИЯТИЕ = Автопредприятие.ИДЕНТИФИКАТОР
JOIN Место_работы ON Заказ.МЕСТО_РАБОТЫ = Место_работы.ИДЕНТИФИКАТОР
WHERE Место_работы.ЛЬГОТА >= 3 AND Автопредприятие.РАСПОЛОЖЕНИЕ != Место_работы.АДРЕС_РАБОТЫ;
```

![image](https://github.com/user-attachments/assets/d4855fdc-f0eb-442c-805c-f0b7b79c5bba)

```
SELECT Техника.ИДЕНТИФИКАТОР, Техника.ТИП
FROM Техника
JOIN Автопредприятие ON Техника.АДРЕС_ГАРАЖА = Автопредприятие.РАСПОЛОЖЕНИЕ
JOIN Заказ ON Заказ.ТЕХНИКА = Техника.ИДЕНТИФИКАТОР
WHERE Заказ.АВТОПРЕДПРИЯТИЕ = Автопредприятие.ИДЕНТИФИКАТОР;
```

![image](https://github.com/user-attachments/assets/89401166-77c2-4817-a149-2b8aad446782)

```
SELECT DISTINCT Техника.ТИП
FROM Техника
JOIN Заказ ON Техника.ИДЕНТИФИКАТОР = Заказ.ТЕХНИКА
JOIN Автопредприятие ON Заказ.АВТОПРЕДПРИЯТИЕ = Автопредприятие.ИДЕНТИФИКАТОР
WHERE Заказ.ОПЛАТА_РУБ > 115000
GROUP BY Техника.ТИП
HAVING COUNT(DISTINCT Автопредприятие.ИДЕНТИФИКАТОР) > 1;
```

![image](https://github.com/user-attachments/assets/1fa6c2ca-59f3-4c25-96c4-d00988f8340f)

```
SELECT Место_работы.НАЗВАНИЕ_ОРГ
FROM Заказ
JOIN Место_работы ON Заказ.МЕСТО_РАБОТЫ = Место_работы.ИДЕНТИФИКАТОР
GROUP BY Место_работы.НАЗВАНИЕ_ОРГ
HAVING SUM(Заказ.ОПЛАТА_РУБ) > 100000;
```

![image](https://github.com/user-attachments/assets/6705adf9-33a7-4139-8581-3b77e108f6dc)


8) Создать запрос для модификации всех значений столбца с суммарной величиной оплаты таблицы заказ, чтобы он содержал истинную сумму, оплачиваемую организацией-заказчиком ( с учетом льгот). Вывести новые значения.

   код:
```
UPDATE Заказ
SET ОПЛАТА_РУБ = ОПЛАТА_РУБ * (1 - Место_работы.ЛЬГОТА / 100)
FROM Место_работы
WHERE Заказ.МЕСТО_РАБОТЫ = Место_работы.ИДЕНТИФИКАТОР;

-- После обновления выводим новые значения:
SELECT НОМЕР, ДАТА, ОПЛАТА_РУБ
FROM Заказ;
```

![image](https://github.com/user-attachments/assets/7aeef32b-fb8c-402a-b3d3-a5c08b05cd2f)
 

9) Расширить таблицу с данными о азаказах столбцом, содержащим величину взимаемых комиссионых. Создать запрос для ввода конкретных значений во все строки таблицы заказов.

    код:
```
ALTER TABLE Заказ
ADD COLUMN КОММ_ВЕЛИЧИНА NUMERIC;
```

![image](https://github.com/user-attachments/assets/00e27c7b-8e6f-4dfa-b520-cd2b2c13b9c8)

```
UPDATE Заказ
SET КОММ_ВЕЛИЧИНА = Автопредприятие.КОМИССИОННЫЕ
FROM Автопредприятие
WHERE Заказ.АВТОПРЕДПРИЯТИЕ = Автопредприятие.ИДЕНТИФИКАТОР;
```

![image](https://github.com/user-attachments/assets/3891c998-2d27-41db-ab06-775e394ef320)


Уровень 2


10) Используя операцию IN (NOT IN)  реализовать следующие запросы:
    
  a) определить такие места работы, в которых не работала техника, размещенная в Н.Новгороде;
  
  b) найти технику которую предоставляли автопредприятия с другим адресом и не бравшие заказы на работу в детском саду;
  
  c) запрос задания 7.а и 7.b.

11) Используя операции ALL-ANY реализовать следующие запросы:
    
  a) найти среди автопредприятий, имевших заказы в четверг, автопредприятия с минимальным рамером комиссионных;

  b) определить максимальную стоимость заказов во вторник;
  
  c) запрос задания 7.с;
  
  d) найти места работы, имеющие минимальный размер льгот.
  

12) Используя операцию UNION получить адреса мест работ и адреса размещения техники.
    

13) Используя операцию EXISTS ( NOT EXISTS ) реализовать нижеследующие запросы. В случае, если для текущего состояния БД запрос будет выдавать пустое множество строк, требуется указать какие добавления в БД необходимо провести.
    
  a) найти места работы на которые направлялась вся техника не из Н.Новгорода;

  b) определить такие автопредприятия, кторые не получали заказов на поставку автокранов;
  
  c) найти технику, которую направляли на все такие места работы, которые не делали заказов техники автопредприятиям чужих районов;
  
  d) какие типы техники направлялись на овощную базу всеми автопредприятиями не более раза.
  

14) Реализовать запросы с использованием аггрегатных функций:
    
  a) определить число рзличных видов техники, работавшей в детском саду;

  b) найти среднее значение льгот у тех организаций, которые заказывали технику у всех автопредприятий Н.Новгорода;
  
  c)найти суммарные расходы овощной базы на заказы автотехники;
  
  d) найти среди автопредприятий с рпзмером комиссионных больше среднего те, которые предоставляли технику в организации Н.Новгрода.
  

15) Используя средства группировки реализовать следующие запросы:
    
  a) найти такие типпы техники, для которых суммарная стоимость заказов за день не превысила 500000;

  b) для каждого автопредприятия вывести общее число его заказов со стоиомостью более 200000;
  
  c) для каждой организации, в которой работала автотехника, вывести суммарную величину расходов на автотехнику по дням недели;
  
  d) определить те дни, когда количество заказов от организаций не из Н.новгорода превышало три.
  


